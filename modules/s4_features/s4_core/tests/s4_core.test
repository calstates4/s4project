<?php

require_once(drupal_get_path('module', 's4_core') .'/tests/s4_core_base_test.php');

class S4CoreTestCase extends s4WebTestCase {
	
	var $staff;
	
	var $admin;
	
	public function setUp() {
		parent::setUp($this->modules);
		$this->admin = $this->drupalCreateUser($this->roles['administrator']);
		$this->staff = $this->drupalCreateUser($this->roles['staff']);
		$this->authenticated = $this->drupalCreateUser($this->roles['authenticated']);
	}
	
  public static function getInfo() {
    return array(
      'name' => 'S4 Basic Content Test',
      'description' => 'Test basic content creation and access control.',
      'group' => 'Student Signup',
    );
  }
  
  
  
  public function testAnonymousUserSeesHomepage() {
  	$this->drupalLogout();
		$this->drupalGet('<front>');
		$this->assertNoText(t('Access denied'));
  }
  
  public function testAPILoadsUsers() {
    global $base_dir;
    $base = url(drupal_get_path('module', 's4_api_rest'), array('absolute' => true));
  	
  	$this->drupalLogin($this->admin);
  	$this->drupalPost('admin/config/s4/rest-api', 
  		array('term_url' => $base .'/tests/get_terms.txt',
  		'course_url' => $base .'/tests/get_courses.txt',
  		'user_url' => $base .'/tests/get_user.txt',
  		'enrollment_url' => $base .'/tests/get_user_enrollment.txt',
  		'faculty_url' => $base .'/tests/get_faculty_courses.txt',
  		'term_start_argument' => 'start',
  		'term_end_argument' => 'end',
  		'course_term_argument' => 'term',
  		'login_id_argument' => 'login_id',
  		'enrollment_user_id_argument' => 'user_id',
  		'enrollment_term_argument' => 'term',
  		'faculty_user_id_argument' => 'user_id',
  		'faculty_term_argument' => 'term',
  		),
  		t('Save configuration'));
  	$this->assertNoText(t('This is not a valid URL'));
  	$this->assertText(t('REST API settings updated'));
  }
}